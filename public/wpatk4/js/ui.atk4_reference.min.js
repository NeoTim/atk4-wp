jQuery.widget("ui.atk4_reference",{options:{},shown:true,autocomplete:null,_init:function(options){jQuery.extend(this.options,this.default_options,options);this.name=this.element.attr("id");this.element.css({cursor:"pointer"})},showAddDialog:function(){},initAutocomplete:function(ac_options){this.element.combobox();var dropdown=this.element.prev();this.autocomplete=jQuery("#"+this.name+"_autocomplete");this.autocomplete.autocomplete();this.element.addClass("field_reference")},isNewEntry:function(el){var val=jQuery(el).val();var ref=this;if(!val&&ref.element.val()!=""){ref.element.val("");if(ref.element.attr("data-initvalue")!=ref.element.val()){ref.element.attr("data-initvalue",ref.element.val());ref.element.trigger("change_ref")}return false}if(this.element.find(":selected").text()==val)return false;var matches_other=false;this.element.children().each(function(){if(jQuery(this).text()==val){ref.element.val(jQuery(this).val());if(ref.element.attr("data-initvalue")!=ref.element.val()){ref.element.attr("data-initvalue",ref.element.val());ref.element.trigger("change_ref")}matches_other=true}});if(matches_other)return false;if(ref.element.val()!=""){ref.element.val("")}return true},fixBrokenAutocomplete:function(el){var ref=this;if(this.isNewEntry(el)){}else{}},setPlusUrl:function(url,options,title){this.options.plus_url=url;var ref=this;this.autocomplete.parent().after('<a href="'+this.options.plus_url+'" id="'+this.name+'_addlink" class="ref_model_add autocomplete_add gbutton button_style2">+</a>');this.autocomplete.parent().parent().removeClass("wo_button");jQuery("#"+this.name+"_addlink").click(function(ev){ev.preventDefault();jQuery(this).univ().dialogURL("Adding new "+(title?title:".."),ref.options.plus_url+"&val_txt="+escape(ref.autocomplete.val())+"&val_id="+escape(ref.element.val()),options,function(){region.find(".fill_current").val(ref.element.val()).change()})})},getData:function(){var data=[];this.element.children("option").each(function(key,val){if(jQuery(val).val()){data.push([jQuery(val).val(),jQuery.trim(jQuery(val).text())])}});return data}});